<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Tooltips</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="stylesheet" href="../bench/style.css">
		<link rel="stylesheet" href="../src/uPlot.css">
		<style>
			.uplot {
				margin-top: 50px;
			}
		</style>
	</head>
	<body>
		<script src="../dist/uPlot.iife.js"></script>
		<script>
			function makeChart() {
				console.time('chart');

				let opts = {
					width: 600,
					height: 400,
					init(u, opts, data) {
					//	u.moveCursor(100, 100);				// initial cursor position

						let plot = u.root.querySelector(".plot");

						let ttc = u.cursortt = document.createElement("div");
						ttc.className = "tooltip";
						ttc.textContent = "(x,y)";
						ttc.style.pointerEvents = "none";
						ttc.style.position = "absolute";
						ttc.style.background = "rgba(0,0,255,0.1)";
						plot.appendChild(ttc);

						u.seriestt = opts.series.y.map(s => {
							let tt = document.createElement("div");
							tt.className = "tooltip";
							tt.textContent = "Tooltip!";
							tt.style.pointerEvents = "none";
							tt.style.position = "absolute";
							tt.style.background = "rgba(255,0,0,0.1)";
							plot.appendChild(tt);
							return tt;
						});

						function hideTips() {
							ttc.style.display = "none";
							u.seriestt.forEach(tt => {
								tt.style.display = "none";
							});
						}

						function showTips() {
							ttc.style.display = null;
							u.seriestt.forEach(tt => {
								tt.style.display = null;
							});
						}

						plot.addEventListener("mouseleave", () => {
							u.moveCursor(-10, -10);
							hideTips();
						});

						plot.addEventListener("mouseenter", () => {
							showTips();
						});

						hideTips();
					},
					events: {
						cursormove: [
							(u, left, top, idx) => {
								u.cursortt.style.left = left + "px";
								u.cursortt.style.top = top + "px";
								u.cursortt.textContent = "(" + u.valAt(left, "x").toFixed(2) + ", " + u.valAt(top, "y").toFixed(2) + ")";

								// can optimize further by not applying styles if idx did not change
								u.seriestt.forEach((tt, i) => {
									let xVal = data[  0][idx];
									let yVal = data[i+1][idx];

									tt.textContent = "(" + xVal + ", " + yVal + ")";

									tt.style.left = u.posOf(xVal, 'x') + "px";
									tt.style.top = u.posOf(yVal, 'y') + "px";

								});
							}
						]
					},
					scales: {
						x: {
							time: false,
						}
					},
					series: {
						y: [
							{
								label: "blah",
								width: 1,
								color: "green",
							},
						]
					},
					axes: {
						y: [
							{
								values: (vals, space) => vals.map(v => v + 'Â° F'),
							},
						],
					},
				};

				const data = [
					[ 1, 2, 3, 4, 5, 6, 7],
					[40,43,60,65,71,73,80],
				];

				let u = new uPlot.Line(opts, data);
/*
				u.on("cursormove", (left, top, idx) => {
					console.log(left, top, idx);
				});
*/
				document.body.appendChild(u.root);

				console.timeEnd('chart');
			}

			makeChart();
		</script>
	</body>
</html>